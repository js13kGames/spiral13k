function start(){document.getElementById("game::over").style.display="none";document.getElementById("score").textContent=Array(10).join("0");bg_ctx.clearRect(0,0,canvas.width,canvas.height);var e=ctx.createRadialGradient(centerX,centerY,10,centerX,centerY,25);e.addColorStop(.1,"rgba(61,204,248,0)");e.addColorStop(.3,"rgba(61,204,248,0.1)");e.addColorStop(.6,"rgba(61,204,248,0.6)");e.addColorStop(.9,"rgba(61,204,248,0.1)");e.addColorStop(1,"rgba(255,255,255,0)");bg_ctx.lineWidth=1;bg_ctx.strokeStyle="rgba(61,204,248,0.4)";bg_ctx.beginPath();bg_ctx.arc(centerX,centerY,30,0,2*Math.PI);bg_ctx.fillStyle=e;bg_ctx.fill();bg_ctx.beginPath();bg_ctx.arc(centerX,centerY,10,0,2*Math.PI);bg_ctx.fillStyle="rgba(61,204,248,0.2)";bg_ctx.fill();bg_ctx.stroke();d0=new Derivative;score=0;var t=centerX,n=50,r=Math.random()>.3?.7:-.7,i=-.1;meteor={position:new Vec(t,n),velocity:new Vec(r,i)};blocks=[];blocks.push({position:{x:centerX+220*Math.cos(0*Math.PI/180),y:centerY+220*Math.sin(0*Math.PI/180)},delta:{x:220,y:-220},radius:40,direction:-1,angle:90,limit:{min:20,max:160},color:"0,0,0"});blocks.push({position:{x:centerX+220*Math.cos(0*Math.PI/180),y:centerY-220*Math.sin(0*Math.PI/180)},delta:{x:220,y:-220},radius:40,direction:-1,angle:270,limit:{min:200,max:340},color:"0,0,0"});blocks.push({position:{x:centerX+420*Math.cos(0*Math.PI/180),y:centerY-320*Math.sin(0*Math.PI/180)},delta:{x:420,y:-320},radius:40,direction:1,angle:-60,limit:{min:-60,max:60},color:"0,0,0"});blocks.push({position:{x:centerX+420*Math.cos(0*Math.PI/180),y:centerY-320*Math.sin(0*Math.PI/180)},delta:{x:420,y:-320},radius:40,direction:-1,angle:120,limit:{min:120,max:240},color:"0,0,0"});requestAnimationFrame(render)}function render(){ctx.clearRect(0,0,canvas.width,canvas.height);Xm=centerX+moonMotionPath*Math.cos(angle*Math.PI/180);Ym=centerY+moonMotionPath*Math.sin(angle*Math.PI/180);var e=ctx.createRadialGradient(Xm,Ym,10,Xm,Ym,55);e.addColorStop(.4,"rgba(255,255,255,0)");e.addColorStop(.75,"rgba(0,0,0,.2)");e.addColorStop(.8,"rgba(0,0,0,.45)");e.addColorStop(.85,"rgba(0,0,0,.2)");e.addColorStop(1,"rgba(255,255,255,0)");ctx.beginPath();ctx.arc(Xm,Ym,55,0,dPI);ctx.fillStyle=e;ctx.fill();ctx.beginPath();ctx.strokeStyle="rgba(0, 0, 0,.15)";ctx.fillStyle="rgba(0,0,0,.65)";ctx.lineWidth=5;ctx.arc(Xm,Ym,15,0,dPI);ctx.fill();ctx.stroke();ctx.beginPath();ctx.strokeStyle="rgba(0, 0, 0,.2)";ctx.lineWidth=1;ctx.arc(Xm,Ym,45,0,dPI);ctx.stroke();motion();gameover();if(bGAME)requestAnimationFrame(render)}var fMOON_G=-1360;var fEARTH_G=3960;var dPI=2*Math.PI;var bGAME=false;var bMOON_G=false;var bBLOCK_G=false;var moonOrbitR=45;var moonMotionPath=75;var angle=.75*Math.PI;var blocks=[];var d0=[];var meteor=[];var score=0;var canvas=document.getElementById("canvas2d");var background=document.getElementById("background");var ctx=canvas.getContext("2d");var bg_ctx=background.getContext("2d");canvas.width=960;canvas.height=640;background.width=960;background.height=640;var centerX=canvas.width/2;var centerY=canvas.height/2;var blocksStep=function(){var e=blocks.length;var t=1;var n=false;for(var r=e-1;r>=0;r--){blocks[r].position.x=centerX+blocks[r].delta.x*Math.cos(blocks[r].angle*Math.PI/180);blocks[r].position.y=centerY+blocks[r].delta.y*Math.sin(blocks[r].angle*Math.PI/180);var i=Math.pow(blocks[r].position.x-meteor.position.x,2),s=Math.pow(blocks[r].position.y-meteor.position.y,2);if(Math.sqrt(i+s)<=blocks[r].radius){blocks[r].color="0,255,0";n=new Vec(blocks[r].position.x,blocks[r].position.y);score+=100*(-Math.round(Math.sqrt(i+s)-blocks[r].radius)/10);var o=Array(10-score.toString().length).join("0")+score.toString();document.getElementById("score").textContent=o}else{blocks[r].color="0,0,0"}var u=ctx.createRadialGradient(blocks[r].position.x,blocks[r].position.y,10,blocks[r].position.x,blocks[r].position.y,blocks[r].radius);u.addColorStop(.4,"rgba(255,255,255,0)");u.addColorStop(.75,"rgba("+blocks[r].color+",.1)");u.addColorStop(.8,"rgba("+blocks[r].color+",.25)");u.addColorStop(.85,"rgba("+blocks[r].color+",.1)");u.addColorStop(1,"rgba(255,255,255,0)");ctx.beginPath();ctx.arc(blocks[r].position.x,blocks[r].position.y,blocks[r].radius+5,0,dPI);ctx.fillStyle=u;ctx.fill();ctx.beginPath();ctx.strokeStyle="rgba("+blocks[r].color+",.15)";ctx.fillStyle="rgba("+blocks[r].color+",.25)";ctx.lineWidth=5;ctx.arc(blocks[r].position.x,blocks[r].position.y,15,0,dPI);ctx.fill();ctx.stroke();ctx.beginPath();ctx.strokeStyle="rgba("+blocks[r].color+",.2)";ctx.lineWidth=1;ctx.arc(blocks[r].position.x,blocks[r].position.y,35,0,dPI);ctx.stroke();blocks[r].angle-=blocks[r].direction*.42;if(blocks[r].angle>blocks[r].limit.max||blocks[r].angle<blocks[r].limit.min)blocks[r].direction*=-1}bBLOCK_G=n===false?false:true;return n};var meteorStep=function(e,t){delta=1;var n=compute(e,t,delta*0,d0);var r=compute(e,t,delta*.2,n);var i=compute(e,t,delta*.4,r);var s=compute(e,t,delta*1,i);r.iadd(i).imul(2);s.iadd(n).iadd(r).imul(1/6);t.position.iadd(s.position.mul(delta));t.velocity.iadd(s.velocity.mul(delta));if(t.position.x>960)t.position.x=960.0001;if(t.position.x<0)t.position.x=-1e-4;if(t.position.y>640)t.position.y=640.0001;if(t.position.y<0)t.position.y=-1e-4};var motion=function(){var e=Math.sqrt(Math.pow(Xm-meteor.position.x,2)+Math.pow(Ym-meteor.position.y,2));bMOON_G=e<=moonOrbitR?true:false;var t=new Vec(meteor.position.x,meteor.position.y);var n=bMOON_G?new Vec(Xm,Ym):new Vec(centerX,centerY);if(meteor.position.x>canvas.width||meteor.position.x<0)meteor.velocity.x*=-1;if(meteor.position.y>canvas.height||meteor.position.y<0)meteor.velocity.y*=-1;var r=blocksStep();n=r?r:n;meteorStep(n,meteor);ctx.beginPath();ctx.lineWidth=1;ctx.arc(meteor.position.x,meteor.position.y,7,0,dPI);ctx.fillStyle="rgba(255,64,64,0.6)";ctx.strokeStyle="rgba(255,64,64,0.8)";ctx.fill();ctx.stroke();ctx.beginPath();ctx.lineWidth=2;ctx.arc(meteor.position.x,meteor.position.y,10,0,dPI);ctx.stroke();meteor.velocity.x=meteor.velocity.x>5?5:meteor.velocity.x;meteor.velocity.y=meteor.velocity.y>5?5:meteor.velocity.y};var gameover=function(){if(Math.sqrt(Math.pow(centerX-meteor.position.x,2)+Math.pow(centerY-meteor.position.y,2))<=25){bGAME=false;document.getElementById("game::over").style.display="block";document.getElementById("game::info").style.display="block";document.getElementById("points").textContent=score}};canvas.onmousemove=function(e){e.offsetX=e.offsetX|e.layerX;e.offsetY=e.offsetY|e.layerY;angle=Math.atan2(e.offsetY-centerY,e.offsetX-centerX)*180/Math.PI};window.onkeydown=function(e){if(e.keyCode==83){if(!bGAME){document.getElementById("game::info").style.display="none";bGAME=true;start()}}else if(e.keyCode==82){bGAME=false;document.getElementById("game::info").style.display="none";setTimeout(function(){bGAME=true;start()},200)}};var Derivative=function(e,t){this.position=e?e:new Vec(0,0);this.velocity=t?t:new Vec(0,0);this.iadd=function(e){this.position.iadd(e.position);this.velocity.iadd(e.velocity);return this};this.add=function(e){return new Derivative(this.position.add(e.position),this.velocity.add(e.velocity))};this.mul=function(e){return new Derivative(this.position.mul(e),this.velocity.mul(e))};this.imul=function(e){this.position.imul(e);this.velocity.imul(e);return this}};var compute=function(e,t,n,r){var i=r.mul(n).add(t);return new Derivative(i.velocity,acceleration(e,i.position))};var Vec=function(e,t){this.type="Vector";this.x=e;this.y=t};Vec.prototype={sub:function(e){return new Vec(this.x-e.x,this.y-e.y)},iadd:function(e){this.x+=e.x;this.y+=e.y;return this},add:function(e){return new Vec(this.x+e.x,this.y+e.y)},imul:function(e){this.x*=e;this.y*=e;return this},mul:function(e){return new Vec(this.x*e,this.y*e)},normalized:function(){var e=this.x,t=this.y;var n=Math.sqrt(e*e+t*t);return new Vec(e/n,t/n)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},copy:function(){return new Vec(this.x,this.y)}};var acceleration=function(e,t){var n=bMOON_G||bBLOCK_G?fMOON_G:fEARTH_G;var r=e.sub(t);var i=r.length();var s=r.normalized();return s.mul(n/Math.pow(i,2))};var copy=function(){var e={};for(name in this){if(this[name].type=="Vector"){e[name]=this[name].copy()}else{e[name]=this[name]}}return e}